<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Getting Started with SpNeigh • SpNeigh</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Getting Started with SpNeigh">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">SpNeigh</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.9.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/SpNeigh.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/jinming-cheng/SpNeigh/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Getting Started with SpNeigh</h1>
                        <h4 data-toc-skip class="author">Jinming
Cheng</h4>
            <address class="author_afil">
      Centre for Quantitative Medicine, Duke-NUS Medical School,
Singapore, 169857, Singapore<br><h4 data-toc-skip class="date">01 November, 2025</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/jinming-cheng/SpNeigh/blob/HEAD/vignettes/SpNeigh.Rmd" class="external-link"><code>vignettes/SpNeigh.Rmd</code></a></small>
      <div class="d-none name"><code>SpNeigh.Rmd</code></div>
    </address>
</div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>The <strong>SpNeigh</strong> package provides a flexible and
interpretable framework for analyzing spatial neighborhoods in
high-resolution spatial transcriptomics data. Designed with support for
technologies such as 10x Xenium, Vizgen MERFISH, and 10x Visium HD, The
<strong>SpNeigh</strong> facilitates a range of region-aware and
distance-aware analyses. Key features include boundary detection,
spatial weight calculation based on proximity to structural landmarks
(e.g., region centroid or boundary), spatially-informed differential
expression testing using spline-based modeling, and visualization of
local cellular interactions.</p>
<p>By integrating spatial geometry with transcriptomic profiles,
<strong>SpNeigh</strong> helps uncover biologically meaningful spatial
patterns, such as boundary-enriched genes, spatial gradients, and
intercellular interactions, enabling deeper insights into tissue
organization and cellular communication.</p>
<p>This vignette demonstrates the key functionalities of the
<strong>SpNeigh</strong> R package using a real <a href="https://www.10xgenomics.com/datasets/fresh-frozen-mouse-brain-for-xenium-explorer-demo-1-standard" class="external-link">10x
Xenium Fresh Frozen Mouse Brain Tiny Subset Dataset</a>.</p>
<p>We show how to:</p>
<ul>
<li>Identify spatial boundaries and neighboring ring regions</li>
<li>Explore spatial interaction patterns between clusters</li>
<li>Perform different expression analysis between two cell
populations</li>
<li>Compute spatial weights from boundary or centroid proximity</li>
<li>Perform spatial differential expression analysis along spatial
gradients</li>
<li>Perform spatial enrichment analysis along spatial gradients</li>
</ul>
<p>This workflow highlights the analytical flexibility and biological
insights enabled by <strong>SpNeigh</strong>.</p>
</div>
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<p>The <strong>SpNeigh</strong> package can be installed from GitHub by
using:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">install_github</a></span><span class="op">(</span><span class="st">"jinming-cheng/SpNeigh"</span><span class="op">)</span></span></code></pre></div>
<!-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% -->
<!-- %                                                 % -->
</div>
<div class="section level2">
<h2 id="load-packages-and-data">Load packages and data<a class="anchor" aria-label="anchor" href="#load-packages-and-data"></a>
</h2>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/jinming-cheng/SpNeigh" class="external-link">SpNeigh</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span></code></pre></div>
<p>Coordinates of mouse brain dataset</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">coords</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"MouseBrainCoords.rds"</span>,</span>
<span>    package <span class="op">=</span> <span class="st">"SpNeigh"</span></span>
<span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">coords</span><span class="op">)</span></span>
<span><span class="co">#&gt;          x        y cell cluster</span></span>
<span><span class="co">#&gt; 1 1898.815 2540.963    1       4</span></span>
<span><span class="co">#&gt; 2 1895.305 2532.627    2       4</span></span>
<span><span class="co">#&gt; 3 2368.073 2534.409    3       2</span></span>
<span><span class="co">#&gt; 4 1903.726 2560.010    4       4</span></span>
<span><span class="co">#&gt; 5 1917.481 2543.132    5       4</span></span>
<span><span class="co">#&gt; 6 1926.540 2560.044    6       4</span></span></code></pre></div>
<p>Ensure the rownames of <code>coords</code> are the same with the cell
names</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">coords</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">coords</span><span class="op">$</span><span class="va">cell</span></span></code></pre></div>
<p>Log normalized expression data generated by
<code>NormalizeData</code> function in <em>Seurat</em> package</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">logNorm_expr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"LogNormExpr.rds"</span>,</span>
<span>    package <span class="op">=</span> <span class="st">"SpNeigh"</span></span>
<span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">logNorm_expr</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "dgCMatrix"</span></span>
<span><span class="co">#&gt; attr(,"package")</span></span>
<span><span class="co">#&gt; [1] "Matrix"</span></span></code></pre></div>
<p>Annotate clusters based on anatomical brain regions</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">new_cell_types</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    <span class="st">"0"</span> <span class="op">=</span> <span class="st">"Meninges"</span>,</span>
<span>    <span class="st">"1"</span> <span class="op">=</span> <span class="st">"Cerebral_cortex"</span>,</span>
<span>    <span class="st">"2"</span> <span class="op">=</span> <span class="st">"White_matter"</span>,</span>
<span>    <span class="st">"3"</span> <span class="op">=</span> <span class="st">"Cerebral_cortex"</span>,</span>
<span>    <span class="st">"4"</span> <span class="op">=</span> <span class="st">"Cerebral_cortex"</span>,</span>
<span>    <span class="st">"5"</span> <span class="op">=</span> <span class="st">"Thalamus"</span>,</span>
<span>    <span class="st">"6"</span> <span class="op">=</span> <span class="st">"Cerebral_cortex"</span>,</span>
<span>    <span class="st">"7"</span> <span class="op">=</span> <span class="st">"Hippocampus"</span>,</span>
<span>    <span class="st">"8"</span> <span class="op">=</span> <span class="st">"Hippocampus"</span>,</span>
<span>    <span class="st">"9"</span> <span class="op">=</span> <span class="st">"Hippocampus"</span>,</span>
<span>    <span class="st">"10"</span> <span class="op">=</span> <span class="st">"White_matter"</span>,</span>
<span>    <span class="st">"11"</span> <span class="op">=</span> <span class="st">"Cerebral_cortex"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>In this vignette, we focus on cluster-level rather than cell
type–level analyses.</p>
<!-- %                                                 % -->
<!-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% -->
<!-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% -->
<!-- %                                                 % -->
</div>
<div class="section level2">
<h2 id="neighborhood-analysis-for-cluster-2-cells">Neighborhood analysis for cluster 2 cells<a class="anchor" aria-label="anchor" href="#neighborhood-analysis-for-cluster-2-cells"></a>
</h2>
<div class="section level3">
<h3 id="detect-spatial-boundaries">Detect spatial boundaries<a class="anchor" aria-label="anchor" href="#detect-spatial-boundaries"></a>
</h3>
<p>Extract boundaries of cluster 2. Adjust the <code>eps</code> and
<code>minPt</code>s parameters to refine the number of subregions
detected by the default dbscan clustering method.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bon_points_c2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/GetBoundary.html">GetBoundary</a></span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">coords</span>,</span>
<span>    one_cluster <span class="op">=</span> <span class="fl">2</span>,</span>
<span>    eps <span class="op">=</span> <span class="fl">120</span>,</span>
<span>    minPts <span class="op">=</span> <span class="fl">10</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">bon_points_c2</span><span class="op">$</span><span class="va">region_id</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;   1   2 </span></span>
<span><span class="co">#&gt; 572 132</span></span></code></pre></div>
<p>Add boundaries of cluster 2 to the spatial plot</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/PlotBoundary.html">PlotBoundary</a></span><span class="op">(</span><span class="va">coords</span>, boundary <span class="op">=</span> <span class="va">bon_points_c2</span><span class="op">)</span></span></code></pre></div>
<p><img src="SpNeigh_files/figure-html/PlotWithBoundary_C2-1.png" width="100%"></p>
<p>Plot boundary regions</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bon_polys_c2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/BuildBoundaryPoly.html">BuildBoundaryPoly</a></span><span class="op">(</span><span class="va">bon_points_c2</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/PlotRegion.html">PlotRegion</a></span><span class="op">(</span><span class="va">bon_polys_c2</span><span class="op">)</span></span></code></pre></div>
<p><img src="SpNeigh_files/figure-html/PlotRegion_C2-1.png" width="100%"></p>
</div>
<div class="section level3">
<h3 id="obtain-neighborhood-ring-regions">Obtain neighborhood ring regions<a class="anchor" aria-label="anchor" href="#obtain-neighborhood-ring-regions"></a>
</h3>
<p>Get spatial ring-shaped regions by subtracting the original boundary
polygons from their corresponding outer buffered polygons. The
<code>outer_boundary</code> is automatically computed when it is not
supplied.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ring_regions</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/GetRingRegion.html">GetRingRegion</a></span><span class="op">(</span>boundary <span class="op">=</span> <span class="va">bon_points_c2</span><span class="op">)</span></span></code></pre></div>
<p>Plot ring regions</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/PlotRegion.html">PlotRegion</a></span><span class="op">(</span><span class="va">ring_regions</span><span class="op">)</span></span></code></pre></div>
<p><img src="SpNeigh_files/figure-html/PlotRing_C2-1.png" width="100%"></p>
</div>
<div class="section level3">
<h3 id="statistics-of-cells-inside-rings">Statistics of cells inside rings<a class="anchor" aria-label="anchor" href="#statistics-of-cells-inside-rings"></a>
</h3>
<p>Get cells inside rings for cluster 2. (<code><a href="../reference/GetCellsInside.html">GetCellsInside()</a></code>
takes a few seconds to run on this example, but may require several
minutes or longer for larger datasets.)</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cells_ring</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/GetCellsInside.html">GetCellsInside</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">coords</span>, boundary <span class="op">=</span> <span class="va">ring_regions</span><span class="op">)</span></span>
<span><span class="va">cells_ring</span></span>
<span><span class="co">#&gt; Simple feature collection with 4362 features and 3 fields</span></span>
<span><span class="co">#&gt; Geometry type: POINT</span></span>
<span><span class="co">#&gt; Dimension:     XY</span></span>
<span><span class="co">#&gt; Bounding box:  xmin: 1482.997 ymin: 1530.545 xmax: 5441.679 ymax: 3532.463</span></span>
<span><span class="co">#&gt; CRS:           NA</span></span>
<span><span class="co">#&gt; First 10 features:</span></span>
<span><span class="co">#&gt;    cell cluster region_id                  geometry</span></span>
<span><span class="co">#&gt; 21   21       4         1 POINT (2080.017 2559.984)</span></span>
<span><span class="co">#&gt; 22   22       4         1 POINT (2088.025 2526.528)</span></span>
<span><span class="co">#&gt; 23   23       2         1 POINT (2085.119 2546.843)</span></span>
<span><span class="co">#&gt; 24   24       2         1 POINT (2101.906 2549.501)</span></span>
<span><span class="co">#&gt; 25   25       4         1 POINT (2102.112 2540.185)</span></span>
<span><span class="co">#&gt; 26   26       4         1 POINT (2089.812 2539.796)</span></span>
<span><span class="co">#&gt; 27   27       4         1  POINT (2095.253 2533.08)</span></span>
<span><span class="co">#&gt; 28   28       4         1  POINT (2100.02 2527.252)</span></span>
<span><span class="co">#&gt; 29   29       4         1 POINT (2197.507 2524.511)</span></span>
<span><span class="co">#&gt; 30   30       3         1 POINT (2209.931 2542.314)</span></span></code></pre></div>
<p>Plot cells inside rings</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/PlotCellsInside.html">PlotCellsInside</a></span><span class="op">(</span><span class="va">cells_ring</span>, point_size <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span></span></code></pre></div>
<p><img src="SpNeigh_files/figure-html/PlotCellsInsideRing_C2-1.png" width="100%"></p>
<p>Obtain statistics of cells inside rings for cluster 2</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">stats_ring</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/StatsCellsInside.html">StatsCellsInside</a></span><span class="op">(</span><span class="va">cells_ring</span><span class="op">)</span></span></code></pre></div>
<p>Plot proportion of cells in different clusters for each sub region
using bar plot.
<!-- The `stat_column` is used to plot "proportion" or "count". --></p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/PlotStatsBar.html">PlotStatsBar</a></span><span class="op">(</span><span class="va">stats_ring</span>, stat_column <span class="op">=</span> <span class="st">"proportion"</span><span class="op">)</span></span></code></pre></div>
<p><img src="SpNeigh_files/figure-html/PlotStatsBar_Proportion_C2_Ring-1.png" width="100%"></p>
<p>Plot proportion of cells in different clusters for each sub region
using donut chart. If <code>plot_donut = FALSE</code>, pie chart is
used.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/PlotStatsPie.html">PlotStatsPie</a></span><span class="op">(</span><span class="va">stats_ring</span>, plot_donut <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="SpNeigh_files/figure-html/PlotStats_Donut_C2_Ring-1.png" width="100%"></p>
</div>
<div class="section level3">
<h3 id="neighborhood-interaction-of-clusters-inside-rings">Neighborhood interaction of clusters inside rings<a class="anchor" aria-label="anchor" href="#neighborhood-interaction-of-clusters-inside-rings"></a>
</h3>
<p>Compute neighborhood interaction matrix using K-nearest neighbors for
cells inside rings</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">interaction_matrix</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ComputeSpatialInteractionMatrix.html">ComputeSpatialInteractionMatrix</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">coords</span>, <span class="va">cell</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">cells_ring</span><span class="op">$</span><span class="va">cell</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">interaction_matrix</span></span>
<span><span class="co">#&gt;       0  1    2    3    4    5   6 7  8    9  10 11</span></span>
<span><span class="co">#&gt; 0  4090  6 1020  892  882  706 202 6 15   95  46  0</span></span>
<span><span class="co">#&gt; 1     6  0   10   10   11    0   3 0  0    0   0  0</span></span>
<span><span class="co">#&gt; 2  1266 10 1831 1127 1882  648 392 2  0   49  72  1</span></span>
<span><span class="co">#&gt; 3   980  8  973 1409 1190  104 422 3 28  187  13  3</span></span>
<span><span class="co">#&gt; 4   859  3 1685 1185 5684    0 392 0  0    0   0  2</span></span>
<span><span class="co">#&gt; 5   768  0  501   91    0 8227  10 0  0    3   0  0</span></span>
<span><span class="co">#&gt; 6   199  1  331  442  411   12 193 0 14   99   6  2</span></span>
<span><span class="co">#&gt; 7     7  0    3    9    0    0   0 0  0    1   0  0</span></span>
<span><span class="co">#&gt; 8    20  0    5   43    0    0  20 0 29   13   0  0</span></span>
<span><span class="co">#&gt; 9   108  0   39  158    0    1  79 0 11 1064   0  0</span></span>
<span><span class="co">#&gt; 10   43  0   64   12    1    0   5 0  0    0 155  0</span></span>
<span><span class="co">#&gt; 11    0  0    1    3    4    0   2 0  0    0   0  0</span></span></code></pre></div>
<p>Heatmap of a row-scaled interaction matrix for cells inside rings for
cluster 2. The heatmap reveals that clusters 2, 3, and 4 are spatially
adjacent to one another.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/PlotInteractionMatrix.html">PlotInteractionMatrix</a></span><span class="op">(</span><span class="va">interaction_matrix</span><span class="op">)</span></span></code></pre></div>
<p><img src="SpNeigh_files/figure-html/Heatmap_InteractionMatrix_C2_Ring-1.png" width="100%"></p>
<p>The plot of cells inside rings split by clusters further confirms the
co-occurrence of clusters 2, 3, 4 in ring region 1.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/PlotCellsInside.html">PlotCellsInside</a></span><span class="op">(</span><span class="va">cells_ring</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">cluster</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">Seurat</span><span class="fu">::</span><span class="fu"><a href="https://satijalab.org/seurat/reference/SeuratTheme.html" class="external-link">RotatedAxis</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="../reference/AddBoundaryPoly.html">AddBoundaryPoly</a></span><span class="op">(</span><span class="va">ring_regions</span>, linewidth_boundary <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span></span></code></pre></div>
<p><img src="SpNeigh_files/figure-html/PlotCellsInside_SplitByCluster_C2_Ring-1.png" width="100%"></p>
<!-- %                                                 % -->
<!-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% -->
<!-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% -->
<!-- %                                                 % -->
</div>
</div>
<div class="section level2">
<h2 id="de-analysis-of-cluster-2-cells-inside-and-outside-boundaries">DE analysis of cluster 2 cells inside and outside boundaries<a class="anchor" aria-label="anchor" href="#de-analysis-of-cluster-2-cells-inside-and-outside-boundaries"></a>
</h2>
<p>Most cells in cluster 2 are located in sub region 1. Hence, we focus
on the DE analysis between cluster 2 cells inside boundary of sub region
1 and cells in the outside neighboring ring region 1.</p>
<p>Get cells inside the boundaries of cluster 2</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cells_inside</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/GetCellsInside.html">GetCellsInside</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">coords</span>, boundary <span class="op">=</span> <span class="va">bon_points_c2</span><span class="op">)</span></span>
<span><span class="va">cells_inside</span></span>
<span><span class="co">#&gt; Simple feature collection with 5073 features and 3 fields</span></span>
<span><span class="co">#&gt; Geometry type: POINT</span></span>
<span><span class="co">#&gt; Dimension:     XY</span></span>
<span><span class="co">#&gt; Bounding box:  xmin: 1590.613 ymin: 1640.136 xmax: 5443.607 ymax: 3531.379</span></span>
<span><span class="co">#&gt; CRS:           NA</span></span>
<span><span class="co">#&gt; First 10 features:</span></span>
<span><span class="co">#&gt;    cell cluster region_id                  geometry</span></span>
<span><span class="co">#&gt; 3     3       2         1 POINT (2368.073 2534.409)</span></span>
<span><span class="co">#&gt; 20   20       2         1 POINT (2456.959 2560.494)</span></span>
<span><span class="co">#&gt; 31   31       2         1 POINT (2152.998 2554.538)</span></span>
<span><span class="co">#&gt; 43   43       2         1 POINT (2312.183 2555.867)</span></span>
<span><span class="co">#&gt; 44   44       2         1  POINT (2323.21 2551.805)</span></span>
<span><span class="co">#&gt; 50   50       2         1 POINT (2356.391 2544.839)</span></span>
<span><span class="co">#&gt; 52   52       2         1 POINT (2387.844 2537.827)</span></span>
<span><span class="co">#&gt; 53   53       2         1 POINT (2401.216 2526.458)</span></span>
<span><span class="co">#&gt; 54   54       2         1 POINT (2392.535 2555.696)</span></span>
<span><span class="co">#&gt; 55   55       2         1 POINT (2407.538 2545.443)</span></span></code></pre></div>
<p>Obtain cluster 2 cells inside and outside boundary of sub region</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cells_in</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">cells_inside</span>, <span class="va">region_id</span> <span class="op">==</span> <span class="fl">1</span> <span class="op">&amp;</span> <span class="va">cluster</span> <span class="op">==</span> <span class="fl">2</span><span class="op">)</span><span class="op">[[</span><span class="st">"cell"</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="va">cells_out</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">cells_ring</span>, <span class="va">region_id</span> <span class="op">==</span> <span class="fl">1</span> <span class="op">&amp;</span> <span class="va">cluster</span> <span class="op">==</span> <span class="fl">2</span><span class="op">)</span><span class="op">[[</span><span class="st">"cell"</span><span class="op">]</span><span class="op">]</span></span></code></pre></div>
<p>Perform DE analysis between cells inside boundary and outside
boundary using the <code>limma</code> framewrok (<code>lmFit</code> +
<code>eBayes</code>)</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tab</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/RunLimmaDE.html">RunLimmaDE</a></span><span class="op">(</span></span>
<span>    exp_mat <span class="op">=</span> <span class="va">logNorm_expr</span>,</span>
<span>    min.pct <span class="op">=</span> <span class="fl">0.25</span>,</span>
<span>    cells_reference <span class="op">=</span> <span class="va">cells_in</span>,</span>
<span>    cells_target <span class="op">=</span> <span class="va">cells_out</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Top DE genes between cells outside boundary and cells inside
boundary. The DE genes are ordered by the abstract value of
<code>logFC</code> by default.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">tab</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"gene"</span>, <span class="st">"logFC"</span>, <span class="st">"adj.P.Val"</span>, <span class="st">"pct.reference"</span>, <span class="st">"pct.target"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#&gt;            gene    logFC     adj.P.Val pct.reference pct.target</span></span>
<span><span class="co">#&gt; Slc17a7 Slc17a7 2.719412 1.624032e-145     0.3228372  0.7555911</span></span>
<span><span class="co">#&gt; Cabp7     Cabp7 2.256859 1.316819e-126     0.2325064  0.6453674</span></span>
<span><span class="co">#&gt; Arc         Arc 1.932350  7.188753e-73     0.4567430  0.7779553</span></span>
<span><span class="co">#&gt; Neurod6 Neurod6 1.788980 5.267216e-123     0.1224555  0.5063898</span></span>
<span><span class="co">#&gt; Igfbp4   Igfbp4 1.608183  8.429609e-96     0.1437659  0.4952077</span></span>
<span><span class="co">#&gt; Nrn1       Nrn1 1.590518  4.942213e-65     0.2722646  0.5926518</span></span></code></pre></div>
<p>Set a random seed to make PlotExpression results reproducible</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span></code></pre></div>
<p>Expression of top DE genes in cluster 2 cells outside boundary. The
cells are plotted randomly using the given seed when
<code>shuffle = TRUE</code>. If <code>shuffle = FALSE</code>, cells with
higher expression values are plotted last (on the top).</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/PlotExpression.html">PlotExpression</a></span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">coords</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">logNorm_expr</span><span class="op">)</span>, <span class="op">]</span>,</span>
<span>    exp_mat <span class="op">=</span> <span class="va">logNorm_expr</span>,</span>
<span>    genes <span class="op">=</span> <span class="va">tab</span><span class="op">$</span><span class="va">gene</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">]</span>,</span>
<span>    sub_plot <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    one_cluster <span class="op">=</span> <span class="fl">2</span>,</span>
<span>    shuffle <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    point_size <span class="op">=</span> <span class="fl">0.1</span>,</span>
<span>    angle_x_label <span class="op">=</span> <span class="fl">45</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="SpNeigh_files/figure-html/Expression_Slc17a7_c2-1.png" width="100%"></p>
<p>Expression of <em>Slc17a7</em> for cluster 2 cells inside and outside
boundary of sub region 1. Cluster 2 cells outside the boundary show much
higher expression of Slc17a7.</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/PlotExpression.html">PlotExpression</a></span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">coords</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">logNorm_expr</span><span class="op">)</span>, <span class="op">]</span>,</span>
<span>    exp_mat <span class="op">=</span> <span class="va">logNorm_expr</span>,</span>
<span>    genes <span class="op">=</span> <span class="st">"Slc17a7"</span>,</span>
<span>    sub_plot <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    shuffle <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    sub_cells <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">cells_in</span>, <span class="va">cells_out</span><span class="op">)</span>,</span>
<span>    point_size <span class="op">=</span> <span class="fl">0.3</span></span>
<span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="../reference/AddBoundaryPoly.html">AddBoundaryPoly</a></span><span class="op">(</span><span class="va">bon_polys_c2</span><span class="op">[</span><span class="fl">1</span>, <span class="op">]</span>, linewidth_boundary <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span></code></pre></div>
<p><img src="SpNeigh_files/figure-html/Expression_Slc17a7_InOutBoundary-1.png" width="100%"></p>
<p>Expression of a general marker gene <em>Sox10</em> for
Oligodendrocytes (cluster 2 cells). <em>Sox10</em> is expressed in both
cluster 2 cells inside and outside the boundary. This suggests that
cluster 2 cells located near the boundary may represent intermediate
cell states.</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/PlotExpression.html">PlotExpression</a></span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">coords</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">logNorm_expr</span><span class="op">)</span>, <span class="op">]</span>,</span>
<span>    exp_mat <span class="op">=</span> <span class="va">logNorm_expr</span>,</span>
<span>    sub_cells <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">cells_in</span>, <span class="va">cells_out</span><span class="op">)</span>,</span>
<span>    sub_plot <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    genes <span class="op">=</span> <span class="st">"Sox10"</span>,</span>
<span>    shuffle <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    point_size <span class="op">=</span> <span class="fl">0.3</span></span>
<span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="../reference/AddBoundaryPoly.html">AddBoundaryPoly</a></span><span class="op">(</span><span class="va">bon_polys_c2</span><span class="op">[</span><span class="fl">1</span>, <span class="op">]</span>, linewidth_boundary <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span></code></pre></div>
<p><img src="SpNeigh_files/figure-html/PlotExpression_Sox10-1.png" width="100%"></p>
<!-- %                                                 % -->
<!-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% -->
<!-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% -->
<!-- %                                                 % -->
</div>
<div class="section level2">
<h2 id="spatial-de-analysis-of-cells-in-cluster-0-along-spatial-weights">Spatial DE analysis of cells in cluster 0 along spatial weights<a class="anchor" aria-label="anchor" href="#spatial-de-analysis-of-cells-in-cluster-0-along-spatial-weights"></a>
</h2>
<div class="section level3">
<h3 id="detect-spatial-boundaries-1">Detect spatial boundaries<a class="anchor" aria-label="anchor" href="#detect-spatial-boundaries-1"></a>
</h3>
<p>Obtain cells in cluster 0</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cells_c0</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">coords</span>, <span class="va">cluster</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span><span class="op">[</span>, <span class="st">"cell"</span><span class="op">]</span></span></code></pre></div>
<p>Plot cluster 0 cells without boundary</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/PlotBoundary.html">PlotBoundary</a></span><span class="op">(</span><span class="va">coords</span><span class="op">[</span><span class="va">cells_c0</span>, <span class="op">]</span><span class="op">)</span></span></code></pre></div>
<p><img src="SpNeigh_files/figure-html/Plot_NoBoundary_C0-1.png" width="100%"></p>
<p>Get boundaries of cluster 0</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bon_points_c0</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/GetBoundary.html">GetBoundary</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">coords</span>, one_cluster <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span>
<span><span class="va">bon_polys_c0</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/BuildBoundaryPoly.html">BuildBoundaryPoly</a></span><span class="op">(</span><span class="va">bon_points_c0</span><span class="op">)</span></span></code></pre></div>
<p>Plot boundary edges for cluster 0</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/PlotEdge.html">PlotEdge</a></span><span class="op">(</span>boundary_poly <span class="op">=</span> <span class="va">bon_polys_c0</span>, linewidth_boundary <span class="op">=</span> <span class="fl">0.6</span><span class="op">)</span></span></code></pre></div>
<p><img src="SpNeigh_files/figure-html/PlotBoundary_C0-1.png" width="100%"></p>
</div>
<div class="section level3">
<h3 id="compute-and-plot-spatial-weights">Compute and plot spatial weights<a class="anchor" aria-label="anchor" href="#compute-and-plot-spatial-weights"></a>
</h3>
<p>Compute spatial weights based on the distance to boundaries</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">weights_bon</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ComputeBoundaryWeights.html">ComputeBoundaryWeights</a></span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">coords</span>,</span>
<span>    cell_ids <span class="op">=</span> <span class="va">cells_c0</span>,</span>
<span>    boundary <span class="op">=</span> <span class="va">bon_points_c0</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Spatial weights are a named vector, where names correspond to cell
IDs</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">weights_bon</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span></span>
<span><span class="co">#&gt;        39        42        75 </span></span>
<span><span class="co">#&gt; 0.7016421 0.6955660 0.6805249</span></span></code></pre></div>
<p>Alternatively, compute spatial weights based on the distance to
centroids</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">weights_cen</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ComputeCentroidWeights.html">ComputeCentroidWeights</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">coords</span>, cell_ids <span class="op">=</span> <span class="va">cells_c0</span><span class="op">)</span></span></code></pre></div>
<p>Plot boundary weights</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/PlotWeights.html">PlotWeights</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">coords</span>, weights <span class="op">=</span> <span class="va">weights_bon</span>, point_size <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Boundary weights"</span><span class="op">)</span></span></code></pre></div>
<p><img src="SpNeigh_files/figure-html/unnamed-chunk-22-1.png" width="100%"></p>
</div>
<div class="section level3">
<h3 id="perform-spatial-differential-analysis-along-boundary-weights">Perform spatial differential analysis along boundary weights<a class="anchor" aria-label="anchor" href="#perform-spatial-differential-analysis-along-boundary-weights"></a>
</h3>
<p>Run spatial DE analysis for cluster 0 cells along boundary weights
using splines</p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tab_sp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/RunSpatialDE.html">RunSpatialDE</a></span><span class="op">(</span></span>
<span>    exp_mat <span class="op">=</span> <span class="va">logNorm_expr</span><span class="op">[</span>, <span class="va">cells_c0</span><span class="op">]</span>,</span>
<span>    spatial_distance <span class="op">=</span> <span class="va">weights_bon</span>,</span>
<span>    cell_ids <span class="op">=</span> <span class="va">cells_c0</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Top DE genes along boundary weights. The first spline coefficient
(<code>Z1</code>) captures the main expression trend along the spatial
distance. A positive value indicates increasing expression with
distance, while a negative value indicates decreasing expression.</p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">tab_sp</span><span class="op">)</span></span>
<span><span class="co">#&gt;                Z1        Z2        Z3  AveExpr         F P.Value adj.P.Val</span></span>
<span><span class="co">#&gt; Aldh1a2  90.19564 -72.83701  18.56803 1.642933 1156.7476       0         0</span></span>
<span><span class="co">#&gt; Car4    -86.85851  37.72830 -30.91311 3.007433  590.8437       0         0</span></span>
<span><span class="co">#&gt; Col1a1   84.54759 -60.30661  21.47013 1.675953  885.1705       0         0</span></span>
<span><span class="co">#&gt; Dcn     112.15109 -72.28618  28.47200 2.337544 1295.7527       0         0</span></span>
<span><span class="co">#&gt; Fmod     91.46180 -63.54536  20.99449 1.562370 1083.7186       0         0</span></span>
<span><span class="co">#&gt; Gjb2     67.07620 -52.43818  14.55533 1.193263  742.6493       0         0</span></span>
<span><span class="co">#&gt;            gene    trend</span></span>
<span><span class="co">#&gt; Aldh1a2 Aldh1a2 Positive</span></span>
<span><span class="co">#&gt; Car4       Car4 Negative</span></span>
<span><span class="co">#&gt; Col1a1   Col1a1 Positive</span></span>
<span><span class="co">#&gt; Dcn         Dcn Positive</span></span>
<span><span class="co">#&gt; Fmod       Fmod Positive</span></span>
<span><span class="co">#&gt; Gjb2       Gjb2 Positive</span></span></code></pre></div>
<p>Expression of top DE genes along boundary weights</p>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/PlotExpression.html">PlotExpression</a></span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">coords</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">logNorm_expr</span><span class="op">)</span>, <span class="op">]</span>,</span>
<span>    exp_mat <span class="op">=</span> <span class="va">logNorm_expr</span>,</span>
<span>    genes <span class="op">=</span> <span class="va">tab_sp</span><span class="op">$</span><span class="va">gene</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">]</span>,</span>
<span>    sub_plot <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    one_cluster <span class="op">=</span> <span class="fl">0</span>,</span>
<span>    shuffle <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    point_size <span class="op">=</span> <span class="fl">0.1</span>,</span>
<span>    angle_x_label <span class="op">=</span> <span class="fl">45</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="SpNeigh_files/figure-html/Expression_top_genes_boundary-1.png" width="100%"></p>
<p>Plot scaled average expression along boundary weight bins for top 10
spatial DE genes. The scaled average expression ranges from 0 to 1 by
using min-max normalization method.</p>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/PlotSpatialExpression.html">PlotSpatialExpression</a></span><span class="op">(</span></span>
<span>    exp_mat <span class="op">=</span> <span class="va">logNorm_expr</span><span class="op">[</span>, <span class="va">cells_c0</span><span class="op">]</span>,</span>
<span>    spatial_distance <span class="op">=</span> <span class="va">weights_bon</span>,</span>
<span>    scale_method <span class="op">=</span> <span class="st">"minmax"</span>,</span>
<span>    genes <span class="op">=</span> <span class="va">tab_sp</span><span class="op">$</span><span class="va">gene</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">]</span>,</span>
<span>    label_x <span class="op">=</span> <span class="st">"Boundary weights"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="SpNeigh_files/figure-html/Expression_along_boundary_weights_c0-1.png" width="100%"></p>
</div>
</div>
<div class="section level2">
<h2 id="spatial-enrichment-analysis-for-each-gene">Spatial enrichment analysis for each gene<a class="anchor" aria-label="anchor" href="#spatial-enrichment-analysis-for-each-gene"></a>
</h2>
<p>Compute spatial enrichment index (SEI) for each gene based on
boundary weights. The SEI reflects the extent to which gene expression
is enriched in spatially weighted regions. The result is sorted in
descending order by <code>normalized_SEI</code>.</p>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">SEI_bon</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ComputeSpatialEnrichmentIndex.html">ComputeSpatialEnrichmentIndex</a></span><span class="op">(</span></span>
<span>    exp_mat <span class="op">=</span> <span class="va">logNorm_expr</span><span class="op">[</span>, <span class="va">cells_c0</span><span class="op">]</span>,</span>
<span>    weights <span class="op">=</span> <span class="va">weights_bon</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">SEI_bon</span><span class="op">)</span></span>
<span><span class="co">#&gt;      gene      SEI mean_expr normalized_SEI</span></span>
<span><span class="co">#&gt; 1    Fmod 1.742086  1.562370       1.115027</span></span>
<span><span class="co">#&gt; 2    Gjb2 1.325063  1.193263       1.110452</span></span>
<span><span class="co">#&gt; 3 Aldh1a2 1.820161  1.642933       1.107872</span></span>
<span><span class="co">#&gt; 4 Slc13a4 2.106610  1.906511       1.104955</span></span>
<span><span class="co">#&gt; 5  Col1a1 1.842083  1.675953       1.099125</span></span>
<span><span class="co">#&gt; 6  Cyp1b1 1.495145  1.365958       1.094575</span></span></code></pre></div>
<p>Expression of top genes enriched near boundaries</p>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/PlotExpression.html">PlotExpression</a></span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">coords</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">logNorm_expr</span><span class="op">)</span>, <span class="op">]</span>,</span>
<span>    exp_mat <span class="op">=</span> <span class="va">logNorm_expr</span>,</span>
<span>    genes <span class="op">=</span> <span class="va">SEI_bon</span><span class="op">$</span><span class="va">gene</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">]</span>,</span>
<span>    sub_plot <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    one_cluster <span class="op">=</span> <span class="fl">0</span>,</span>
<span>    shuffle <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    point_size <span class="op">=</span> <span class="fl">0.1</span>,</span>
<span>    angle_x_label <span class="op">=</span> <span class="fl">45</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="SpNeigh_files/figure-html/Expression_top_genes_SEI_boundary-1.png" width="100%"></p>
<!-- %                                                 % -->
<!-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% -->
</div>
<div class="section level2">
<h2 id="session-info">Session Info<a class="anchor" aria-label="anchor" href="#session-info"></a>
</h2>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/sessionInfo.html" class="external-link">sessionInfo</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; R version 4.4.1 (2024-06-14)</span></span>
<span><span class="co">#&gt; Platform: aarch64-apple-darwin20</span></span>
<span><span class="co">#&gt; Running under: macOS 15.6.1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Matrix products: default</span></span>
<span><span class="co">#&gt; BLAS:   /Library/Frameworks/R.framework/Versions/4.4-arm64/Resources/lib/libRblas.0.dylib </span></span>
<span><span class="co">#&gt; LAPACK: /Library/Frameworks/R.framework/Versions/4.4-arm64/Resources/lib/libRlapack.dylib;  LAPACK version 3.12.0</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; locale:</span></span>
<span><span class="co">#&gt; [1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; time zone: Asia/Singapore</span></span>
<span><span class="co">#&gt; tzcode source: internal</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; attached base packages:</span></span>
<span><span class="co">#&gt; [1] stats     graphics  grDevices utils     datasets  methods   base     </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; other attached packages:</span></span>
<span><span class="co">#&gt; [1] ggplot2_3.5.1    SpNeigh_0.9.1    BiocStyle_2.34.0</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; loaded via a namespace (and not attached):</span></span>
<span><span class="co">#&gt;   [1] RColorBrewer_1.1-3     rstudioapi_0.17.1      jsonlite_1.8.9        </span></span>
<span><span class="co">#&gt;   [4] magrittr_2.0.3         spatstat.utils_3.1-0   farver_2.1.2          </span></span>
<span><span class="co">#&gt;   [7] rmarkdown_2.29         fs_1.6.5               ragg_1.3.3            </span></span>
<span><span class="co">#&gt;  [10] vctrs_0.6.5            ROCR_1.0-11            spatstat.explore_3.3-3</span></span>
<span><span class="co">#&gt;  [13] htmltools_0.5.8.1      curl_5.2.3             sass_0.4.9            </span></span>
<span><span class="co">#&gt;  [16] sctransform_0.4.1      parallelly_1.38.0      KernSmooth_2.23-24    </span></span>
<span><span class="co">#&gt;  [19] bslib_0.8.0            htmlwidgets_1.6.4      desc_1.4.3            </span></span>
<span><span class="co">#&gt;  [22] ica_1.0-3              plyr_1.8.9             plotly_4.10.4         </span></span>
<span><span class="co">#&gt;  [25] zoo_1.8-12             cachem_1.1.0           igraph_2.1.1          </span></span>
<span><span class="co">#&gt;  [28] mime_0.12              lifecycle_1.0.4        pkgconfig_2.0.3       </span></span>
<span><span class="co">#&gt;  [31] Matrix_1.7-1           R6_2.5.1               fastmap_1.2.0         </span></span>
<span><span class="co">#&gt;  [34] fitdistrplus_1.2-1     future_1.34.0          shiny_1.9.1           </span></span>
<span><span class="co">#&gt;  [37] digest_0.6.37          colorspace_2.1-1       patchwork_1.3.0       </span></span>
<span><span class="co">#&gt;  [40] tensor_1.5             Seurat_5.1.0           RSpectra_0.16-2       </span></span>
<span><span class="co">#&gt;  [43] irlba_2.3.5.1          textshaping_0.4.0      labeling_0.4.3        </span></span>
<span><span class="co">#&gt;  [46] progressr_0.15.0       spatstat.sparse_3.1-0  polyclip_1.10-7       </span></span>
<span><span class="co">#&gt;  [49] httr_1.4.7             abind_1.4-8            compiler_4.4.1        </span></span>
<span><span class="co">#&gt;  [52] proxy_0.4-27           withr_3.0.2            DBI_1.2.3             </span></span>
<span><span class="co">#&gt;  [55] fastDummies_1.7.4      highr_0.11             MASS_7.3-61           </span></span>
<span><span class="co">#&gt;  [58] concaveman_1.1.0       classInt_0.4-10        tools_4.4.1           </span></span>
<span><span class="co">#&gt;  [61] units_0.8-5            lmtest_0.9-40          httpuv_1.6.15         </span></span>
<span><span class="co">#&gt;  [64] future.apply_1.11.3    goftest_1.2-3          glue_1.8.0            </span></span>
<span><span class="co">#&gt;  [67] dbscan_1.2.2           nlme_3.1-166           promises_1.3.0        </span></span>
<span><span class="co">#&gt;  [70] grid_4.4.1             sf_1.0-18              Rtsne_0.17            </span></span>
<span><span class="co">#&gt;  [73] cluster_2.1.6          reshape2_1.4.4         generics_0.1.3        </span></span>
<span><span class="co">#&gt;  [76] gtable_0.3.6           spatstat.data_3.1-2    class_7.3-22          </span></span>
<span><span class="co">#&gt;  [79] tidyr_1.3.1            data.table_1.16.2      sp_2.1-4              </span></span>
<span><span class="co">#&gt;  [82] spatstat.geom_3.3-3    RcppAnnoy_0.0.22       ggrepel_0.9.6         </span></span>
<span><span class="co">#&gt;  [85] RANN_2.6.2             pillar_1.11.1          stringr_1.5.1         </span></span>
<span><span class="co">#&gt;  [88] limma_3.61.12          spam_2.11-0            RcppHNSW_0.6.0        </span></span>
<span><span class="co">#&gt;  [91] later_1.3.2            splines_4.4.1          dplyr_1.1.4           </span></span>
<span><span class="co">#&gt;  [94] lattice_0.22-6         deldir_2.0-4           survival_3.7-0        </span></span>
<span><span class="co">#&gt;  [97] FNN_1.1.4.1            tidyselect_1.2.1       miniUI_0.1.1.1        </span></span>
<span><span class="co">#&gt; [100] pbapply_1.7-2          knitr_1.48             gridExtra_2.3         </span></span>
<span><span class="co">#&gt; [103] V8_6.0.2               bookdown_0.42          scattermore_1.2       </span></span>
<span><span class="co">#&gt; [106] xfun_0.49              statmod_1.5.0          matrixStats_1.4.1     </span></span>
<span><span class="co">#&gt; [109] stringi_1.8.4          lazyeval_0.2.2         yaml_2.3.10           </span></span>
<span><span class="co">#&gt; [112] evaluate_1.0.1         codetools_0.2-20       tibble_3.2.1          </span></span>
<span><span class="co">#&gt; [115] BiocManager_1.30.25    cli_3.6.5              uwot_0.2.2            </span></span>
<span><span class="co">#&gt; [118] xtable_1.8-4           reticulate_1.43.0      systemfonts_1.1.0     </span></span>
<span><span class="co">#&gt; [121] munsell_0.5.1          jquerylib_0.1.4        Rcpp_1.1.0            </span></span>
<span><span class="co">#&gt; [124] spatstat.random_3.3-2  globals_0.16.3         png_0.1-8             </span></span>
<span><span class="co">#&gt; [127] spatstat.univar_3.0-1  parallel_4.4.1         pkgdown_2.1.1         </span></span>
<span><span class="co">#&gt; [130] dotCall64_1.2          listenv_0.9.1          viridisLite_0.4.2     </span></span>
<span><span class="co">#&gt; [133] scales_1.3.0           e1071_1.7-16           ggridges_0.5.6        </span></span>
<span><span class="co">#&gt; [136] SeuratObject_5.0.2     leiden_0.4.3.1         purrr_1.0.2           </span></span>
<span><span class="co">#&gt; [139] rlang_1.1.6            cowplot_1.1.3</span></span></code></pre></div>
<div style="page-break-after: always;"></div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Jinming Cheng.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
